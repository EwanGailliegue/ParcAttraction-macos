<div class="page">
  <section class="hero">
    <h1>Attractions</h1>
    <p class="subtitle">Recherche et filtres pour trouver rapidement ce que tu veux.</p>

    <div class="filters">
      <!-- Recherche -->
      <div class="field">
        <label>Recherche</label>
        <input [(ngModel)]="search" type="text" placeholder="Ex: montagne, eau..." />
      </div>

      <!-- Filtre difficulté -->
      <div class="field">
        <label>Difficulté min.</label>
        <select [(ngModel)]="minDifficulty">
          <option value="">Toutes</option>
          <option [ngValue]="1">1+</option>
          <option [ngValue]="2">2+</option>
          <option [ngValue]="3">3+</option>
          <option [ngValue]="4">4+</option>
          <option [ngValue]="5">5</option>
        </select>
      </div>

      <!-- Tri -->
      <div class="field">
        <label>Trier</label>
        <select [(ngModel)]="sort">
          <option value="difficulty_desc">Difficulté (desc)</option>
          <option value="difficulty_asc">Difficulté (asc)</option>
          <option value="name">Nom (A → Z)</option>
        </select>
      </div>

      <button class="reset" type="button" (click)="resetFilters()">Réinitialiser</button>
    </div>
  </section>

  <div class="meta">{{ filtered.length }} attraction(s)</div>

  <section class="grid" *ngIf="filtered.length; else empty">
    <article class="card" *ngFor="let a of filtered">
      <div class="card-top">
        <h3>{{ a.nom }}</h3>
        <span class="badge">{{ (a.difficulte ?? 0) }}/5</span>
      </div>

      <p class="desc">{{ a.description }}</p>
      <div class="hint">{{ difficultyLabel(a.difficulte) }}</div>

      <div class="rating" *ngIf="getCritiqueStat(a) as s">
        <ng-container *ngIf="s.count > 0; else noReviews">
          <div class="stars" aria-label="note moyenne">
            <span class="star" *ngFor="let _ of [1,2,3,4,5]; let i = index">
              <span class="star-base">★</span>
              <span
                class="star-fill"
                [style.width.%]="starFillPercent(s.avg, i + 1)"
              >★</span>
            </span>
          </div>

          <span class="avg">{{ formatAvg(s.avg) }}</span>
          <span class="count">({{ s.count }} avis)</span>
        </ng-container>

        <ng-template #noReviews>
          <span class="no-reviews">Aucun avis</span>
        </ng-template>
      </div>

      <button
        mat-stroked-button
        type="button"
        (click)="openCritiqueDialog(a)"
      >
        Laisser un avis / voir les avis
      </button>
    </article>
  </section>

  <ng-template #empty>
    <div class="empty">
      <h3>Aucun résultat</h3>
      <p>Essaie un autre mot-clé ou diminue la difficulté minimale.</p>
    </div>
  </ng-template>
</div>

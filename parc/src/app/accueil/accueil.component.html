<div class="page">
  <section class="hero">
    <h1>{{ 'HOME.TITLE' | translate }}</h1>
    <p class="subtitle">{{ 'HOME.SUBTITLE' | translate }}</p>

    <div class="filters">
      <!-- Recherche -->
      <div class="field">
        <label>{{ 'HOME.SEARCH' | translate }}</label>
        <input [(ngModel)]="search" type="text" [placeholder]="'HOME.SEARCH_PLACEHOLDER' | translate" />
      </div>

      <!-- Filtre difficulté -->
      <div class="field">
        <label>{{ 'HOME.MIN_DIFFICULTY' | translate }}</label>
        <select [(ngModel)]="minDifficulty">
          <option value="">{{ 'HOME.ALL' | translate }}</option>
          <option [ngValue]="1">1+</option>
          <option [ngValue]="2">2+</option>
          <option [ngValue]="3">3+</option>
          <option [ngValue]="4">4+</option>
          <option [ngValue]="5">5</option>
        </select>
      </div>

      <!-- Tri -->
      <div class="field">
        <label>{{ 'HOME.SORT' | translate }}</label>
        <select [(ngModel)]="sort">
          <option value="difficulty_desc">{{ 'HOME.SORT_DIFF_DESC' | translate }}</option>
          <option value="difficulty_asc">{{ 'HOME.SORT_DIFF_ASC' | translate }}</option>
          <option value="name">{{ 'HOME.SORT_NAME' | translate }}</option>
        </select>
      </div>

      <button class="reset" type="button" (click)="resetFilters()">{{ 'HOME.RESET' | translate }}</button>
    </div>
  </section>

  <div class="meta">{{ filtered.length }} {{ 'HOME.COUNT' | translate }}</div>

  <section class="grid" *ngIf="filtered.length; else empty">
    <article class="card" *ngFor="let a of filtered">
      <div class="card-top">
        <h3>{{ a.nom }}</h3>
        <span class="badge">{{ (a.difficulte ?? 0) }}/5</span>
      </div>

      <p class="desc">{{ a.description }}</p>
      <div class="hint">{{ difficultyLabel(a.difficulte) }}</div>

      <div class="rating" *ngIf="getCritiqueStat(a) as s">
        <ng-container *ngIf="s.count > 0; else noReviews">
          <div class="stars" aria-label="note moyenne">
            <span class="star" *ngFor="let _ of [1,2,3,4,5]; let i = index">
              <span class="star-base">★</span>
              <span
                class="star-fill"
                [style.width.%]="starFillPercent(s.avg, i + 1)"
              >★</span>
            </span>
          </div>

          <span class="avg">{{ formatAvg(s.avg) }}</span>
          <span class="count">({{ s.count }} {{ 'HOME.REVIEWS' | translate }})</span>
        </ng-container>

        <ng-template #noReviews>
          <span class="no-reviews">{{ 'HOME.NO_REVIEWS' | translate }}</span>
        </ng-template>
      </div>

      <button
        mat-stroked-button
        type="button"
        (click)="openCritiqueDialog(a)"
      >
        {{ 'HOME.LEAVE_REVIEW' | translate }}
      </button>
    </article>
  </section>

  <ng-template #empty>
    <div class="empty">
      <h3>{{ 'HOME.NO_RESULT_TITLE' | translate }}</h3>
      <p>{{ 'HOME.NO_RESULT_DESC' | translate }}</p>
    </div>
  </ng-template>
</div>
